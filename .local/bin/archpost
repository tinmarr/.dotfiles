#!/usr/bin/env bash

mag="\e[35m"
green="\e[32m"
reset="\e[m"

# Dotfile requirements
sudo pacman -S --needed git github-cli zsh openssh neovim acpi acpilight alsa-utils ripgrep eza bat direnv

# Pyenv requirements
sudo pacman -S --needed base-devel openssl zlib xz tk

# Configure user
chsh -s /bin/zsh
sudo usermod -a -G video $USER

# Setup dotfiles
cd $HOME
printf "$mag""Authenticate gh with an SSH Key""$reset""\n"
gh auth login # login with ssh 
gh repo clone tinmarr/.dotfiles -- --bare
mv .dotfiles.git .dotfiles
git --git-dir=.dotfiles --work-tree=. checkout -f
git --git-dir=.dotfiles --work-tree=. submodule update --init --recursive
git --git-dir=.dotfiles --work-tree=. config --local status.showUntrackedFiles no

# Setup fonts
fc-cache -f -v

# Install utilities
printf "$mag""Installing Utilities""$reset""\n"
curl https://pyenv.run | bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -si && cd .. && rm -rf yay
git clone --depth 1 https://github.com/wbthomason/packer.nvim ~/.local/share/nvim/site/pack/packer/start/packer.nvim

printf "$mag""neovim will now launch. Please run :PackerSync.\nPress any key to continue.""$reset"
read tmp
nvim



yay -S --needed neofetch btop ranger man xdg-user-dirs

printf "$mag""Install WM things? [Y/n] ""$reset"
read wm
case $wm in 
    "n" | "N")
        echo "Skipping WM things"
        ;;
    *)
        printf "$mag""Which WMs? (package names, space seperated) [awesome, qtile] ""$reset"
        yay -S --needed "$mag"
        if [[ "$mag" = "qtile" ]]; then
            yay -S --needed qtile-extras
        fi

        echo 'Section "InputClass"
            Identifier "devname"
            Driver "libinput"
            MatchIsTouchpad "on"
            Option "Tapping" "on"
            Option "ClickMethod" "clickfinger"
            Option "NaturalScrolling" "true"
        EndSection' | sudo tee /etc/X11/xorg.conf.d/30-touchpad.conf > /dev/null

        echo 'Section "Device"
            Identifier "Intel Graphics"
            Driver "intel"
            Option "TearFree" "true"
        EndSection' | sudo tee /etc/X11/xorg.conf.d/20-intel.conf > /dev/null

        yay -S --needed kdeconnect kitty bemenu pavucontrol betterlockscreen autorandr \
            dunst qt5ct-kde picom python-dbus-next lxappearance-gtk3 gnu-free-fonts ly \
            brave-beta-bin thunar visual-studio-code-bin obsidian playerctl tlp pinentry-dmenu
        sudo systemctl enable ly
        sudo systemctl disable getty@tty2.service
        sudo systemctl enable autorandr
        sudo systemctl enable autorandr-lid-listener.service
        sudo cp ~/.config/tlp.conf /etc
        sudo systemctl enable tlp
        gh repo clone tinmarr/obsidian-vault
        printf "$mag""The following tools need to be configured manually:
            - lxappearance
            - qt5ct
            - brave
            - visual-studio-code""$reset""\n"
        ;;
esac
printf "$green""Setup Complete\!""$reset""\n"
